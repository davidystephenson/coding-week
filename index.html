<h1 id='time'>10</h1>
<h2>
  <span id="player"></span>
  <button id="red">Red</button>
  <button id="black">Black</button>
</h1>
<h1>Players</h1>
<div id="list"></div>

<script>
  const time = document.getElementById('time')
  const red = document.getElementById('red')
  const black = document.getElementById('black')
  const player = document.getElementById('player')
  const list = document.getElementById('list')

  red.style.backgroundColor = 'red'
  black.style.backgroundColor = 'black'
  black.style.color = 'white'

  const api = 'https://coding-week.onrender.com'
  // const api = 'http://localhost:10000'
  const source = new EventSource(`${api}/connect`)
  source.onmessage = function (event) {
    const game = JSON.parse(event.data)
    time.innerText = game.time
    time.style.color = game.color

    player.innerText = `${game.player.id}: $${game.player.money}`
    player.style.color = game.player.bet
    if (game.player.bet === 'red') {
      red.style.fontSize = '20px'
      black.style.fontSize = '14px'
    } else {
      black.style.fontSize = '20px'
      red.style.fontSize = '14px'
    }

    list.innerHTML = ''

    const players = Object.values(game.players)
    players.sort((a, b) => b.money - a.money)

    for (const player of players) {
      const paragraph = document.createElement('p')
      paragraph.innerText = `${player.id}: $${player.money}`
      paragraph.style.color = player.bet
      if (player.id === game.player.id) {
        paragraph.style.fontSize = '20px'
      }
      list.appendChild(paragraph)
    }

    red.onclick = async function () {
      await fetch(`${api}/red/${game.player.id}`)
    }

    black.onclick = async function () {
      await fetch(`${api}/black/${game.player.id}`)
    }
  }
</script>